<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/heatmap.js"></script>
<script src="https://code.highcharts.com/modules/treemap.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<div id="container" style="height: 100vh; width: 90vw;"></div>

<script>

$.getJSON('data/station_data2017.json', function (data) {

    var points = [],
        regionP,
        regionVal,
        regionI = 0,
        stationP,
        stationI,
        exitsP,
        exitsI,
        region,
        station,
        exits,
        exitName = {
            'Total Exits': 'Total Exits',
        };

    for (region in data) {
        if (data.hasOwnProperty(region)) {
            regionVal = 0;
            regionP = {
                id: 'id_' + regionI,
                name: region,
                color: Highcharts.getOptions().colors[regionI+4]
            };
            stationI = 0;
            for (station in data[region]) {
                if (data[region].hasOwnProperty(station)) {
                    stationP = {
                        id: regionP.id + '_' + stationI,
                        name: station,
                        parent: regionP.id
                    };
                    points.push(stationP);
                    exitsI = 0;
                    for (exits in data[region][station]) {
                        if (data[region][station].hasOwnProperty(exits)) {
                            exitsP = {
                                id: stationP.id + '_' + exitsI,
                                name: station,
                                parent: stationP.id,
                                value: Math.round(+data[region][station][exits])
                            };
                            regionVal += exitsP.value;
                            points.push(exitsP);
                            exitsI = exitsI + 1;
                        }
                    }
                    stationI = stationI + 1;
                }
            }
            regionP.value = regionVal;
            console.log(regionP);
            points.push(regionP);
            regionI = regionI + 1;
        }
    }
    Highcharts.chart('container', {
        series: [{
            type: 'treemap',
            layoutAlgorithm: 'squarified',
            allowDrillToNode: true,
            animationLimit: 1000,
            dataLabels: {
                allowOverlap: true,
                enabled: false
            },
            levelIsConstant: true,
            levels: [{
                level: 1,
                dataLabels: {
                    enabled: true,
                    align: 'left',
                    verticalAlign: 'top',
                    style: {
                        fontSize: '20px',
                        fontWeight: 'bold'
                    }                    
                },
                borderWidth: 5
            },{
                level: 2,
                dataLabels: {
                    enabled: true,
                    style: {
                        fontSize: '12px'
                    }                    
                },
                borderWidth: 3
            }],
            data: points
        }],
        subtitle: {
            text: 'The size of the square indicates proportion of rider exits in that region of the Bay Area or at that station. Scroll over station name to see total rider exits from that station in 2017. Source: BART'
        },
        title: {
            text: 'BART Ridership: Total Exits per Station in 2017',
            style: {
                fontSize: '20px',
                fontWeight: 'bold'
            }   
        }
    });

});
</script>